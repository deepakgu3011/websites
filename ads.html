<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Random Mid Roll VAST Ads</title>

<link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet">

<style>
body{
  font-family: Arial;
  background:#111;
  color:#fff;
  text-align:center;
}
#playBtn{
  padding:12px 25px;
  font-size:16px;
  cursor:pointer;
  margin-bottom:15px;
}
.video-js{
  margin:auto;
}
</style>
</head>

<body>

<h2>Random 6 Mid-Roll Ads</h2>

<button id="playBtn">â–¶ Play Video</button>

<video
  id="videoPlayer"
  class="video-js vjs-default-skin"
  width="640"
  height="360"
  controls
  preload="auto"
  playsinline
  webkit-playsinline>

  <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
</video>

<script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
<script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
<script src="https://unpkg.com/videojs-contrib-ads@6/dist/videojs-contrib-ads.min.js"></script>
<script src="https://unpkg.com/videojs-ima@1/dist/videojs.ima.min.js"></script>

<script>
var player = videojs('videoPlayer');

player.ima({
  adTagUrl: "https://fantasticcommunity.com/d.mUF/zCdNGkNCvCZEGWUF/QeRmQ9ou/ZMUrl/kXPnTrYH2uNeTOYr2AMpD_gStUN_jlY/1qN/j/YkwKO/S/ZxsgaVWG1Vp/dnDf0RxGdnDf0RxG",
  maxRedirects: 10,
  debug: true
});

let adsInitialized = false;
let midRollTimes = [];
let playedMidRolls = [];

// Generate random mid-roll times
function generateRandomMidRolls(duration, count = 6) {
  const times = new Set();

  while (times.size < count) {
    let t = Math.floor(Math.random() * (duration - 10)) + 5;
    times.add(t);
  }

  return Array.from(times).sort((a, b) => a - b);
}

document.getElementById("playBtn").addEventListener("click", function () {
  if (!adsInitialized) {
    player.ima.initializeAdDisplayContainer();
    player.ima.requestAds(); // pre-roll try
    adsInitialized = true;
  }
  player.play();
});

player.on("loadedmetadata", function () {
  const duration = Math.floor(player.duration());
  midRollTimes = generateRandomMidRolls(duration, 6);
  console.log("Random mid-roll times:", midRollTimes);
});

player.on("timeupdate", function () {
  const currentTime = Math.floor(player.currentTime());

  midRollTimes.forEach((time) => {
    if (currentTime >= time && !playedMidRolls.includes(time)) {
      playedMidRolls.push(time);
      console.log("Requesting ad at:", time);
      player.ima.requestAds();
    }
  });
});
</script>

</body>
</html>
